[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

# ============================================================
# BUN SERVICE (Next.js / frontend)
# ============================================================

[program:bun]
command=/app/scripts/start-bun.sh
directory=/app/project
autostart=true
autorestart=true
startretries=3
stdout_logfile=/var/log/supervisor/bun.log
stdout_logfile_maxbytes=10MB
redirect_stderr=true
environment=NODE_ENV="%(ENV_KOSUKE_MODE)s",KOSUKE_MODE="%(ENV_KOSUKE_MODE)s",KOSUKE_BUN_DIR="%(ENV_KOSUKE_BUN_DIR)s"
priority=10

# ============================================================
# PYTHON SERVICE (FastAPI / engine) - Optional
# ============================================================

[program:python]
command=/app/scripts/start-python.sh
directory=/app/project
autostart=true
autorestart=true
startretries=3
stdout_logfile=/var/log/supervisor/python.log
stdout_logfile_maxbytes=10MB
redirect_stderr=true
environment=KOSUKE_MODE="%(ENV_KOSUKE_MODE)s",KOSUKE_PYTHON_DIR="%(ENV_KOSUKE_PYTHON_DIR)s"
priority=10

# ============================================================
# AGENT SERVER (Fastify)
# ============================================================

[program:agent]
command=bun run /app/agent/dist/index.js
directory=/app/agent
autostart=true
autorestart=true
startretries=3
stdout_logfile=/var/log/supervisor/agent.log
stdout_logfile_maxbytes=10MB
redirect_stderr=true
environment=PORT="%(ENV_KOSUKE_AGENT_PORT)s",PROJECT_DIR="/app/project",NODE_ENV="production"
priority=5
